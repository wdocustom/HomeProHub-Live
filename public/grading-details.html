<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8" />
  <title>HomeProHub – Grading System Details</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .hero {
      max-width: 900px;
      margin: 48px auto 24px;
      padding: 0 24px;
      text-align: center;
    }
    .hero-title {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.03em;
      margin-bottom: 10px;
      color: #111827;
    }
    .hero-subtitle {
      font-size: 14px;
      line-height: 1.6;
      color: #6b7280;
      max-width: 640px;
      margin: 0 auto;
    }
    .content-grid {
      max-width: 900px;
      margin: 0 auto 60px;
      padding: 0 24px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }
    @media (max-width: 800px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
    }
    .grade-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e5e7eb;
    }
    .grade-title {
      font-size: 20px;
      margin: 0;
    }
    .grade-pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 6px;
      background: #f0f4ff;
      color: #2563eb;
      font-weight: 600;
    }
    .criteria-list {
      list-style: none;
      padding: 0;
      margin: 10px 0 0;
      font-size: 14px;
      color: #4b5563;
    }
    .criteria-list li {
      margin-bottom: 10px;
      padding-left: 15px;
      position: relative;
    }
    .criteria-list li::before {
      content: "✓";
      color: #10b981;
      font-weight: 700;
      position: absolute;
      left: 0;
    }
  </style></head><body><header class="navbar">
  <div class="nav-inner">
    <div class="brand-area">
      <div class="brand-logo">H</div>
      <div class="brand-name">HomeProHub</div>
    </div>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <div class="profile-area">
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>
  </div>
</header><main>
  <section class="hero">
    <h1 class="hero-title">HomeProHub Grading System: Transparency in Vetting.</h1>
    <p class="hero-subtitle">
      Our grading system (A+ to F) is based on clear, weighted metrics, not just random reviews. Learn exactly how we score both contractors and homeowners.
    </p>
  </section>

  <section class="content-grid" id="gradingContent">
    <p style="grid-column: 1 / -1; text-align: center;">Loading grading criteria...</p>
  </section></main><script>
(function() {
  'use strict';

  // Standardized localStorage keys
  const STORAGE_KEYS = {
    USER_PROFILE: 'homeprohub_user',
    USER_ROLE: 'homeprohub_user_role',
    AUTH_TOKEN: 'homeprohub_auth_token',
    USERNAME: 'homeprohub_username',
    PROFILE_COMPLETE: 'homeprohub_profile_complete',
    CONTRACTOR_PROFILE: 'homeprohub_contractor_profile',
    HISTORY: 'homeprohub_history_v1'
  };

  /**
   * Sanitize text for display (prevent XSS)
   */
  function sanitizeText(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = String(text);
    return div.innerHTML;
  }

  /**
   * Get user data from localStorage
   */
  function getUserData() {
    try {
      const role = localStorage.getItem(STORAGE_KEYS.USER_ROLE);
      const authToken = localStorage.getItem(STORAGE_KEYS.AUTH_TOKEN);
      const rawProfile = localStorage.getItem(STORAGE_KEYS.USER_PROFILE);

      if (!role || !authToken) {
        return null;
      }

      const profile = rawProfile ? JSON.parse(rawProfile) : {};
      return {
        role: role,
        name: profile.name || 'User',
        email: profile.email || ''
      };
    } catch (e) {
      return null;
    }
  }

  /**
   * Clear all user data from localStorage
   */
  function clearAllData() {
    Object.values(STORAGE_KEYS).forEach(key => {
      try {
        localStorage.removeItem(key);
      } catch (e) {
        // Silent fail
      }
    });
  }

  /**
   * Logout function
   */
  window.logout = function() {
    clearAllData();

    try {
      const authToken = localStorage.getItem(STORAGE_KEYS.AUTH_TOKEN);
      if (authToken) {
        fetch('/api/logout', {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${authToken}` }
        }).catch(() => {});
      }
    } catch (e) {}

    window.location.href = 'index.html';
  };

  /**
   * Initialize user profile link
   */
  function initializeAuth() {
    const user = getUserData();
    const profileArea = document.querySelector('.profile-area');

    // Check if user is logged in
    if (!user || !user.name) {
      clearAllData();
      window.location.href = 'index.html';
      return false;
    }

    // Add profile link if it doesn't exist
    if (profileArea && !profileArea.querySelector('.profile-link')) {
      const nameLink = document.createElement('a');
      nameLink.href = 'user-profile.html';
      nameLink.className = 'profile-link';
      nameLink.textContent = sanitizeText(user.name.split(' ')[0]);
      profileArea.prepend(nameLink);
    }

    return true;
  }

  /**
   * Load grading data from server
   */
  async function loadGradingData() {
    const contentGrid = document.getElementById('gradingContent');
    if (!contentGrid) return;

    contentGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center;">Loading grading criteria...</p>';

    try {
      // Fetch data from the server (use relative path)
      const response = await fetch('/grading-data', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem(STORAGE_KEYS.AUTH_TOKEN)}`
        }
      });

      if (!response.ok) {
        throw new Error(`Server returned status: ${response.status}`);
      }

      const data = await response.json();

      // --- CONTRACTOR CRITERIA CARD ---
      const contractorCard = document.createElement('div');
      contractorCard.className = 'card';
      contractorCard.innerHTML = `
        <div class="grade-header">
          <h2 class="grade-title">Contractor Grade Criteria</h2>
          <span class="grade-pill">Visible to Homeowners</span>
        </div>
        <p style="font-size: 14px; color: #4b5563;">
          ${data.contractor_grading_criteria.description}
        </p>
        <h3 style="font-size: 16px; margin: 15px 0 5px;">Key Data Points (Weight)</h3>
        <ul class="criteria-list">
          <li>State/City License Verification (Weight: 30%)</li>
          <li>Completed Projects (Volume and Diversity) (Weight: 20%)</li>
          <li>Completion on Time (Adherence to contract timelines) (Weight: 15%)</li>
          <li>Number of client complaints (past 2 years) (Weight: 15%)</li>
          <li>Average response time on platform (for communication score) (Weight: 10%)</li>
          <li>Clarity of scope language in uploaded bids (AI assessed) (Weight: 10%)</li>
          <li>Historical data on payment disputes (low score on financial risk) (Weight: 10%)</li>
        </ul>
      `;
      contentGrid.appendChild(contractorCard);

      // --- HOMEOWNER CRITERIA CARD ---
      const homeownerCard = document.createElement('div');
      homeownerCard.className = 'card';
      homeownerCard.innerHTML = `
        <div class="grade-header">
          <h2 class="grade-title">Homeowner Grade Criteria</h2>
          <span class="grade-pill" style="background:#fff3f2; color:#ef4444;">Visible to Contractors Only</span>
        </div>
        <p style="font-size: 14px; color: #4b5563;">
          ${data.homeowner_grading_criteria.description}
        </p>
        <h3 style="font-size: 16px; margin: 15px 0 5px;">Key Data Points (Weight)</h3>
        <ul class="criteria-list">
          ${data.homeowner_grading_criteria.data_points_required.map((point, index) => {
            const weights = data.homeowner_grading_criteria.grade_weighting;
            const keys = Object.keys(weights);
            let weightKey = keys[index % keys.length]; 
            return `<li>${point} (Weight: ${weights[weightKey]}%)</li>`;
          }).join('')}
        </ul>
      `;
      contentGrid.appendChild(homeownerCard);

    } catch (error) {
      contentGrid.innerHTML = `
        <div class="card" style="grid-column: 1 / -1; text-align: center; color: #ef4444;">
          <h3>Error Loading Grading Data</h3>
          <p>Could not connect to the server or data is unavailable. Please try again later.</p>
          <p style="font-size: 12px; color: #9ca3af; margin-top: 10px;">
            If the problem persists, please contact support.
          </p>
        </div>
      `;
    }
  }

  /**
   * Initialize the page
   */
  function initialize() {
    // Check authentication first
    if (!initializeAuth()) {
      return;
    }

    // Load grading data
    loadGradingData();
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initialize);
  } else {
    initialize();
  }
})();
</script></body></html>