<!DOCTYPE html><html><head>
  <title>HomeProHub ‚Äì Choose Role</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .form-container {
      max-width: 480px;
      margin: 80px auto;
      padding: 30px 24px;
      text-align: center;
    }
    .form-title {
      font-size: 26px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .form-sub {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 24px;
    }
    .role-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
    }
    .role-btn {
      padding: 15px 20px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #f9fafb;
      text-decoration: none;
      font-size: 16px;
      font-weight: 600;
      color: #1f2937;
      cursor: pointer;
      display: block;
    }
    .role-btn:hover {
        background-color: #f3f4f6;
        border-color: #d1d5db;
    }
  </style></head><body>
    <main>
        <div class="form-container card">
            <h1 class="form-title">Welcome! How are you using HomeProHub?</h1>
            <p class="form-sub">
                Please select your primary role to access the correct tools and content.
            </p>

            <div class="role-grid">
                <button class="role-btn" data-role="homeowner">üè° I am a Homeowner</button>
                <button class="role-btn" data-role="contractor">üß∞ I am a Contractor / Trades Pro</button>
            </div>
        </div>
    </main>

    <script>
    const roleButtons = document.querySelectorAll('.role-btn');
    const username = localStorage.getItem('homeprohub_username');
    const token = localStorage.getItem('homeprohub_auth_token');

    if (!username || !token) {
        // If not authenticated, redirect to login
        window.location.href = 'index.html';
    }

    // --- UTILITY ---
    async function postData(url, data) {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}` 
            },
            body: JSON.stringify(data)
        });
        return response;
    }

    // --- EVENT LISTENERS ---
    roleButtons.forEach(button => {
        button.addEventListener('click', async () => {
            const role = button.getAttribute('data-role');
            
            try {
                // Call the server to save the role
                const response = await postData('/api/set-role', { username, role });

                if (response.ok) {
                    // 1. Save the role locally for quick checks
                    localStorage.setItem('homeprohub_user_role', role);
                    
                    // 2. Redirect to the appropriate dashboard
                    if (role === 'homeowner') {
                        window.location.href = 'home.html';
                    } else if (role === 'contractor') {
                        // After selecting role, redirect to profile setup page (onboarding funnel)
                        window.location.href = 'contractor-profile.html'; 
                    }
                } else {
                    alert('Error saving role on server. Please try again.');
                }
            } catch (error) {
                alert('Network error during role selection.');
            }
        });
    });
    
    // The previous error was a missing brace here. This closure now ensures balance.
</script>
</body></html>