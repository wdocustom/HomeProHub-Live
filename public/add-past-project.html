<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Import Past Project | HomeProHub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="components/navigation.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/services/auth.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">
  <!-- Navigation component will be injected here by navigation.js -->

  <main class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

    <!-- Page Header -->
    <div class="mb-8">
      <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight mb-3">Import Past Project</h1>
      <p class="text-lg text-slate-500 font-medium">
        Add reviews from off-platform clients to boost your grade. Upload proof of work to verify the transaction.
      </p>
    </div>

    <!-- Import Form -->
    <form id="importForm" class="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">

      <!-- Client Information -->
      <div class="p-8 border-b border-slate-100">
        <h2 class="text-xl font-extrabold text-slate-900 tracking-tight mb-1 flex items-center gap-2">
          <i class="fa-solid fa-user text-blue-600"></i>
          Client Information
        </h2>
        <p class="text-sm text-slate-400 font-bold uppercase tracking-wider mb-6">Required for verification</p>

        <div class="space-y-4">
          <!-- Client Name -->
          <div>
            <label for="clientName" class="block text-sm font-bold text-slate-700 mb-2">
              Client Name *
            </label>
            <input
              type="text"
              id="clientName"
              name="clientName"
              required
              class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-slate-900"
              placeholder="John Smith"
            />
          </div>

          <!-- Client Email -->
          <div>
            <label for="clientEmail" class="block text-sm font-bold text-slate-700 mb-2">
              Client Email *
            </label>
            <input
              type="email"
              id="clientEmail"
              name="clientEmail"
              required
              class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-slate-900"
              placeholder="john@example.com"
            />
          </div>

          <!-- Client Phone -->
          <div>
            <label for="clientPhone" class="block text-sm font-bold text-slate-700 mb-2">
              Client Phone *
            </label>
            <input
              type="tel"
              id="clientPhone"
              name="clientPhone"
              required
              class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-slate-900"
              placeholder="(555) 123-4567"
            />
          </div>
        </div>
      </div>

      <!-- Proof of Work -->
      <div class="p-8 border-b border-slate-100">
        <h2 class="text-xl font-extrabold text-slate-900 tracking-tight mb-1 flex items-center gap-2">
          <i class="fa-solid fa-file-invoice text-blue-600"></i>
          Proof of Work
        </h2>
        <p class="text-sm text-slate-400 font-bold uppercase tracking-wider mb-6">Upload invoice or contract</p>

        <div class="space-y-4">
          <!-- File Upload -->
          <div>
            <label class="block text-sm font-bold text-slate-700 mb-2">
              Invoice / Contract *
            </label>
            <div class="relative">
              <input
                type="file"
                id="proofDocument"
                name="proofDocument"
                required
                accept=".pdf,.jpg,.jpeg,.png"
                class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-slate-900 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
              />
            </div>
            <p class="mt-2 text-xs text-slate-500">Accepted: PDF, JPG, PNG (Max 10MB)</p>
          </div>
        </div>
      </div>

      <!-- Review Rating -->
      <div class="p-8 border-b border-slate-100">
        <h2 class="text-xl font-extrabold text-slate-900 tracking-tight mb-1 flex items-center gap-2">
          <i class="fa-solid fa-star text-blue-600"></i>
          Client Review
        </h2>
        <p class="text-sm text-slate-400 font-bold uppercase tracking-wider mb-6">Rate this client's performance</p>

        <div class="space-y-6">
          <!-- Payment Speed -->
          <div>
            <label class="block text-sm font-bold text-slate-700 mb-3">
              Payment Speed *
            </label>
            <div class="flex gap-2">
              <label class="flex-1 relative">
                <input type="radio" name="rating_payment" value="1" required class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  1
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_payment" value="2" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  2
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_payment" value="3" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  3
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_payment" value="4" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  4
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_payment" value="5" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  5
                </div>
              </label>
            </div>
            <div class="flex justify-between mt-2 text-xs text-slate-500">
              <span>Late/Chased</span>
              <span>Instant/On-Time</span>
            </div>
          </div>

          <!-- Scope Adherence -->
          <div>
            <label class="block text-sm font-bold text-slate-700 mb-3">
              Scope Adherence *
            </label>
            <div class="flex gap-2">
              <label class="flex-1 relative">
                <input type="radio" name="rating_scope" value="1" required class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  1
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_scope" value="2" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  2
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_scope" value="3" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  3
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_scope" value="4" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  4
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_scope" value="5" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  5
                </div>
              </label>
            </div>
            <div class="flex justify-between mt-2 text-xs text-slate-500">
              <span>Scope Creep</span>
              <span>Stuck to Plan</span>
            </div>
          </div>

          <!-- Site Conditions -->
          <div>
            <label class="block text-sm font-bold text-slate-700 mb-3">
              Site Conditions *
            </label>
            <div class="flex gap-2">
              <label class="flex-1 relative">
                <input type="radio" name="rating_site" value="1" required class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  1
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_site" value="2" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  2
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_site" value="3" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  3
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_site" value="4" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  4
                </div>
              </label>
              <label class="flex-1 relative">
                <input type="radio" name="rating_site" value="5" class="peer sr-only" />
                <div class="h-12 flex items-center justify-center border-2 border-slate-300 rounded-xl cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition-all">
                  5
                </div>
              </label>
            </div>
            <div class="flex justify-between mt-2 text-xs text-slate-500">
              <span>Nightmare Access</span>
              <span>Perfect Site</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Legal Certification -->
      <div class="p-8 bg-slate-50">
        <label class="flex items-start gap-3 cursor-pointer">
          <input
            type="checkbox"
            id="certifyTransact

ion"
            name="certifyTransaction"
            required
            class="mt-1 w-5 h-5 text-blue-600 border-slate-300 rounded focus:ring-blue-500"
          />
          <span class="text-sm text-slate-700 font-medium">
            I certify that this transaction is real and I have proof of completed work. Submitting false information may result in account suspension.
          </span>
        </label>
      </div>

      <!-- Form Actions -->
      <div class="px-8 py-6 bg-slate-50 border-t border-slate-100 flex justify-between items-center">
        <a
          href="/contractor-grade.html"
          class="px-6 py-3 bg-white border-2 border-slate-300 text-slate-700 font-bold rounded-xl hover:bg-slate-50 transition-colors"
        >
          Cancel
        </a>
        <button
          type="submit"
          id="submitBtn"
          class="px-8 py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg shadow-blue-600/20 hover:scale-105 transition-transform flex items-center gap-2"
        >
          <i class="fa-solid fa-upload"></i>
          <span>Submit Review</span>
        </button>
      </div>
    </form>

  </main>

  <script src="components/navigation.js"></script>
  <script>
    // Handle form submission
    document.getElementById('importForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> <span>Uploading...</span>';

      try {
        // Get form data
        const formData = new FormData();
        formData.append('client_name', document.getElementById('clientName').value);
        formData.append('client_email', document.getElementById('clientEmail').value);
        formData.append('client_phone', document.getElementById('clientPhone').value);
        formData.append('rating_payment', parseInt(document.querySelector('input[name="rating_payment"]:checked').value));
        formData.append('rating_scope', parseInt(document.querySelector('input[name="rating_scope"]:checked').value));
        formData.append('rating_site', parseInt(document.querySelector('input[name="rating_site"]:checked').value));
        formData.append('proof_document', document.getElementById('proofDocument').files[0]);

        // Submit to API
        const user = await window.authService.getCurrentUser();
        const response = await fetch('/api/client-reviews/import', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${await window.authService.getAccessToken()}`
          },
          body: formData
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'Failed to submit review');
        }

        // Success
        alert('Review submitted successfully! It will be verified and added to your grade within 24 hours.');
        window.location.href = '/contractor-grade.html';

      } catch (error) {
        console.error('Error submitting review:', error);
        alert('Error: ' + error.message);
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fa-solid fa-upload"></i> <span>Submit Review</span>';
      }
    });
  </script>
</body>
</html>
