<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HomeProHub â€“ Contractor Profile</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .profile-container { max-width: 900px; margin: 40px auto; padding: 0 24px; }
    .profile-header { background: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .tabs { display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 2px solid #e5e7eb; }
    .tab { padding: 12px 24px; cursor: pointer; border: none; background: none; font-size: 15px; color: #6b7280; transition: all 0.2s; }
    .tab.active { color: #2563eb; border-bottom: 2px solid #2563eb; margin-bottom: -2px; font-weight: 600; }
    .tab:hover { color: #2563eb; }
    .tab-content { display: none; background: white; padding: 32px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .tab-content.active { display: block; }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
    .form-group-full { grid-column: 1 / -1; }
    @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
<header class="navbar">
  <div class="nav-inner">
    <div class="brand-area">
      <div class="brand-logo">H</div>
      <div class="brand-name">HomeProHub</div>
    </div>
    <div class="nav-links">
      <a href="contractor.html">Dashboard</a>
      <div class="profile-area">
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>
  </div>
</header>

<div class="profile-container">
  <div class="profile-header">
    <h1 style="margin: 0 0 8px 0; font-size: 28px;">Contractor Profile</h1>
    <p style="margin: 0; color: #6b7280;">Manage your business information and settings</p>
  </div>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('basic')">Basic Info</button>
    <button class="tab" onclick="switchTab('social')">Social Media</button>
  </div>

  <div id="basicTab" class="tab-content active">
    <h2 style="margin-top: 0;">Business Information</h2>
    <form id="profileForm" novalidate>
      <div class="form-grid">
        <div class="form-group">
          <label for="firstName">First Name</label>
          <input id="firstName" type="text" placeholder="John" maxlength="50" />
        </div>
        <div class="form-group">
          <label for="lastName">Last Name</label>
          <input id="lastName" type="text" placeholder="Doe" maxlength="50" />
        </div>
        <div class="form-group">
          <label for="businessName">Business Name</label>
          <input id="businessName" type="text" placeholder="ABC Construction Inc." maxlength="100" />
        </div>
        <div class="form-group">
          <label for="yearsInBusiness">Years in Business</label>
          <input id="yearsInBusiness" type="number" placeholder="5" min="0" max="100" />
        </div>
        <div class="form-group">
          <label for="licenseNumber">License Number</label>
          <input id="licenseNumber" type="text" placeholder="ABC-123456" maxlength="50" />
        </div>
        <div class="form-group">
          <label for="trade">Primary Trade</label>
          <select id="trade">
            <option value="">Select trade...</option>
            <option value="General Contractor">General Contractor</option>
            <option value="Mechanical Contractor">Mechanical Contractor</option>
            <option value="Plumber">Plumber</option>
            <option value="Electrician">Electrician</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="form-group form-group-full">
          <label for="street">Street Address</label>
          <input id="street" type="text" placeholder="123 Main St" maxlength="200" />
        </div>
        <div class="form-group">
          <label for="city">City</label>
          <input id="city" type="text" placeholder="Springfield" maxlength="100" />
        </div>
        <div class="form-group">
          <label for="state">State</label>
          <input id="state" type="text" placeholder="IL" maxlength="2" />
        </div>
        <div class="form-group">
          <label for="zipCode">ZIP Code</label>
          <input id="zipCode" type="text" placeholder="62701" pattern="[0-9]{5}" maxlength="5" />
        </div>
      </div>
      <button type="submit" class="btn-primary" id="saveButton">Save Profile</button>
      <p id="statusMessage" style="margin-top: 12px; font-size: 14px;"></p>
    </form>
  </div>

  <div id="socialTab" class="tab-content">
    <h2 style="margin-top: 0;">Social Media Links</h2>
    <form id="socialForm" novalidate>
      <div class="form-grid">
        <div class="form-group form-group-full">
          <label for="instagram">Instagram</label>
          <input id="instagram" type="url" placeholder="https://instagram.com/yourprofile" maxlength="200" />
        </div>
        <div class="form-group form-group-full">
          <label for="facebook">Facebook</label>
          <input id="facebook" type="url" placeholder="https://facebook.com/yourpage" maxlength="200" />
        </div>
        <div class="form-group form-group-full">
          <label for="tiktok">TikTok</label>
          <input id="tiktok" type="url" placeholder="https://tiktok.com/@yourprofile" maxlength="200" />
        </div>
        <div class="form-group form-group-full">
          <label for="youtube">YouTube</label>
          <input id="youtube" type="url" placeholder="https://youtube.com/c/yourchannel" maxlength="200" />
        </div>
        <div class="form-group form-group-full">
          <label for="reddit">Reddit</label>
          <input id="reddit" type="url" placeholder="https://reddit.com/u/yourusername" maxlength="200" />
        </div>
      </div>
      <button type="submit" class="btn-primary" id="saveSocialButton">Save Social Links</button>
      <p id="socialStatusMessage" style="margin-top: 12px; font-size: 14px;"></p>
    </form>
  </div>
</div>

<script>
const STORAGE_KEYS = {
  USER_PROFILE: 'homeprohub_user',
  USER_ROLE: 'homeprohub_user_role',
  AUTH_TOKEN: 'homeprohub_auth_token',
  USERNAME: 'homeprohub_username',
  PROFILE_COMPLETE: 'homeprohub_profile_complete',
  CONTRACTOR_PROFILE: 'homeprohub_contractor_profile'
};

function switchTab(tabName) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

  if (tabName === 'basic') {
    document.querySelector('.tab:nth-child(1)').classList.add('active');
    document.getElementById('basicTab').classList.add('active');
  } else if (tabName === 'social') {
    document.querySelector('.tab:nth-child(2)').classList.add('active');
    document.getElementById('socialTab').classList.add('active');
  }
}

function logout() {
  Object.values(STORAGE_KEYS).forEach(key => localStorage.removeItem(key));
  window.location.href = 'index.html';
}

(function() {
    'use strict';

    const profileForm = document.getElementById('profileForm');
    const socialForm = document.getElementById('socialForm');
    const saveButton = document.getElementById('saveButton');
    const saveSocialButton = document.getElementById('saveSocialButton');
    const statusMessage = document.getElementById('statusMessage');
    const socialStatusMessage = document.getElementById('socialStatusMessage');

    function checkAuth() {
        const username = localStorage.getItem(STORAGE_KEYS.USERNAME);
        const authToken = localStorage.getItem(STORAGE_KEYS.AUTH_TOKEN);
        const role = localStorage.getItem(STORAGE_KEYS.USER_ROLE);

        if (!username || !authToken || role !== 'contractor') {
            window.location.href = 'index.html';
            return false;
        }
        return true;
    }

    function loadProfile() {
        try {
            const profileData = localStorage.getItem(STORAGE_KEYS.CONTRACTOR_PROFILE);
            if (profileData) {
                const profile = JSON.parse(profileData);
                if (profile.firstName) document.getElementById('firstName').value = profile.firstName;
                if (profile.lastName) document.getElementById('lastName').value = profile.lastName;
                if (profile.businessName) document.getElementById('businessName').value = profile.businessName;
                if (profile.yearsInBusiness) document.getElementById('yearsInBusiness').value = profile.yearsInBusiness;
                if (profile.licenseNumber) document.getElementById('licenseNumber').value = profile.licenseNumber;
                if (profile.trade) document.getElementById('trade').value = profile.trade;
                if (profile.street) document.getElementById('street').value = profile.street;
                if (profile.city) document.getElementById('city').value = profile.city;
                if (profile.state) document.getElementById('state').value = profile.state;
                if (profile.zipCode) document.getElementById('zipCode').value = profile.zipCode;
                if (profile.instagram) document.getElementById('instagram').value = profile.instagram;
                if (profile.facebook) document.getElementById('facebook').value = profile.facebook;
                if (profile.tiktok) document.getElementById('tiktok').value = profile.tiktok;
                if (profile.youtube) document.getElementById('youtube').value = profile.youtube;
                if (profile.reddit) document.getElementById('reddit').value = profile.reddit;
            }
        } catch (err) {
            console.error('Error loading profile:', err);
        }
    }

    profileForm.addEventListener('submit', function(e) {
        e.preventDefault();
        saveButton.disabled = true;
        saveButton.textContent = 'Saving...';

        try {
            const existing = localStorage.getItem(STORAGE_KEYS.CONTRACTOR_PROFILE);
            const profile = existing ? JSON.parse(existing) : {};

            profile.firstName = document.getElementById('firstName').value.trim();
            profile.lastName = document.getElementById('lastName').value.trim();
            profile.businessName = document.getElementById('businessName').value.trim();
            profile.companyName = document.getElementById('businessName').value.trim();
            profile.yearsInBusiness = document.getElementById('yearsInBusiness').value.trim();
            profile.licenseNumber = document.getElementById('licenseNumber').value.trim();
            profile.license = profile.licenseNumber;
            profile.trade = document.getElementById('trade').value;
            profile.street = document.getElementById('street').value.trim();
            profile.city = document.getElementById('city').value.trim();
            profile.state = document.getElementById('state').value.trim();
            profile.zipCode = document.getElementById('zipCode').value.trim();
            profile.profileComplete = true;

            localStorage.setItem(STORAGE_KEYS.CONTRACTOR_PROFILE, JSON.stringify(profile));
            localStorage.setItem(STORAGE_KEYS.PROFILE_COMPLETE, 'true');

            statusMessage.textContent = 'Profile saved successfully!';
            statusMessage.style.color = '#10b981';
        } catch (err) {
            statusMessage.textContent = 'Error saving profile';
            statusMessage.style.color = '#ef4444';
        } finally {
            saveButton.disabled = false;
            saveButton.textContent = 'Save Profile';
        }
    });

    socialForm.addEventListener('submit', function(e) {
        e.preventDefault();
        saveSocialButton.disabled = true;
        saveSocialButton.textContent = 'Saving...';

        try {
            const existing = localStorage.getItem(STORAGE_KEYS.CONTRACTOR_PROFILE);
            const profile = existing ? JSON.parse(existing) : {};

            profile.instagram = document.getElementById('instagram').value.trim();
            profile.facebook = document.getElementById('facebook').value.trim();
            profile.tiktok = document.getElementById('tiktok').value.trim();
            profile.youtube = document.getElementById('youtube').value.trim();
            profile.reddit = document.getElementById('reddit').value.trim();

            localStorage.setItem(STORAGE_KEYS.CONTRACTOR_PROFILE, JSON.stringify(profile));

            socialStatusMessage.textContent = 'Social links saved successfully!';
            socialStatusMessage.style.color = '#10b981';
        } catch (err) {
            socialStatusMessage.textContent = 'Error saving social links';
            socialStatusMessage.style.color = '#ef4444';
        } finally {
            saveSocialButton.disabled = false;
            saveSocialButton.textContent = 'Save Social Links';
        }
    });

    if (!checkAuth()) return;
    loadProfile();
})();
</script>
</body>
</html>